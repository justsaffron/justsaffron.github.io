<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moodboards — The Waanderer's Log</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lilex:wght@100;200;300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
<style>
.boards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1px; background: var(--border);
}

.board-card {
  background: var(--sand-dark);
  position: relative; overflow: hidden; cursor: pointer;
  aspect-ratio: 4/5; display: flex; flex-direction: column;
  transition: background 0.3s;
}

.board-card:hover .board-overlay { opacity: 1; }

.board-images {
  flex: 1; position: relative; overflow: hidden;
}

.board-images-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr; height: 100%; gap: 1px;
}

.board-img-thumb {
  overflow: hidden; background: var(--sand-mid);
}

.board-img-thumb img {
  width: 100%; height: 100%; object-fit: cover;
  filter: saturate(0.8); transition: transform 0.5s, filter 0.3s;
}

.board-card:hover .board-img-thumb img {
  transform: scale(1.05); filter: saturate(1.1);
}

.board-info {
  padding: 1.2rem 1.5rem;
  background: linear-gradient(0deg, rgba(26,15,0,0.98) 60%, rgba(26,15,0,0.7) 100%);
}

.board-name { font-size: 0.9rem; font-weight: 400; color: var(--white); margin-bottom: 0.3rem; }
.board-desc { font-size: 0.6rem; color: var(--text-muted); line-height: 1.6; }
.board-count { font-size: 0.5rem; letter-spacing: 0.2em; color: var(--text-dim); margin-top: 0.5rem; text-transform: uppercase; }

.board-overlay {
  position: absolute; inset: 0;
  background: rgba(26,15,0,0.7);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 1rem; opacity: 0; transition: opacity 0.3s;
}

.board-empty-thumb {
  background: rgba(232,168,74,0.05);
  display: flex; align-items: center; justify-content: center;
  color: var(--text-dim); font-size: 1.2rem;
}

.add-board-btn {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 0.8rem; aspect-ratio: 4/5;
  border: 1px dashed rgba(232,168,74,0.15); background: transparent;
  color: var(--text-dim); font-size: 0.6rem; letter-spacing: 0.2em;
  text-transform: uppercase; cursor: pointer; transition: all 0.3s;
}

.add-board-btn:hover {
  border-color: rgba(232,168,74,0.4); color: var(--sand-gold);
  background: rgba(232,168,74,0.03);
}

/* LIGHTBOX */
.lightbox {
  position: fixed; inset: 0; background: rgba(10,6,0,0.97);
  z-index: 600; display: none; flex-direction: column;
}

.lightbox.open { display: flex; }

.lightbox-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 1.5rem 2rem; border-bottom: 1px solid var(--border);
}

.lightbox-title { font-size: 0.8rem; font-weight: 300; color: var(--white); }
.lightbox-close {
  background: none; border: none; color: var(--text-muted);
  font-size: 1.2rem; cursor: pointer; transition: color 0.2s;
  font-family: var(--font);
}
.lightbox-close:hover { color: var(--white); }

.lightbox-body {
  flex: 1; overflow-y: auto; padding: 2rem;
}

.lightbox-image-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 2px;
}

.lightbox-img-item {
  aspect-ratio: 1; overflow: hidden; cursor: zoom-in;
  position: relative;
}

.lightbox-img-item img {
  width: 100%; height: 100%; object-fit: cover;
  filter: saturate(0.85); transition: transform 0.4s, filter 0.3s;
}

.lightbox-img-item:hover img { transform: scale(1.05); filter: saturate(1.1); }

.lightbox-img-item .delete-img {
  position: absolute; top: 4px; right: 4px;
  background: rgba(26,15,0,0.8); border: none; color: var(--terra);
  font-size: 0.65rem; cursor: pointer; padding: 0.2rem 0.5rem;
  font-family: var(--font); display: none;
}

.lightbox-img-item:hover .delete-img { display: block; }

.lightbox-add-btn {
  aspect-ratio: 1; border: 1px dashed rgba(232,168,74,0.2);
  display: flex; align-items: center; justify-content: center;
  color: var(--text-dim); font-size: 0.6rem; letter-spacing: 0.2em;
  text-transform: uppercase; cursor: pointer; flex-direction: column; gap: 0.5rem;
  transition: all 0.3s; background: none;
}

.lightbox-add-btn:hover { border-color: rgba(232,168,74,0.4); color: var(--sand-gold); }
</style>
</head>
<body>

<nav>
  <a class="nav-logo" href="index.html">The Waanderer's Log</a>
  <ul class="nav-links">
    <li><a href="projects.html">Projects</a></li>
    <li><a href="mtg.html">MTG</a></li>
    <li><a href="moodboards.html" class="active">Moodboards</a></li>
    <li><a href="photography.html">Photography</a></li>
    <li><a href="reviews.html">Reviews</a></li>
    <li><a href="resources.html">Resources</a></li>
    <li><a href="editor.html" class="edit-link">✦ Edit</a></li>
  </ul>
</nav>

<div class="page-header">
  <div class="page-header-left">
    <p class="page-eyebrow">03 · Moodboards</p>
    <h1 class="page-title">Visual <em>Worlds</em></h1>
    <p class="page-subtitle">Collections of art, illustration, photography, and visual references. Each board is a different territory of the imagination.</p>
  </div>
  <button class="btn btn-primary" onclick="openModal('board-modal')">+ New Board</button>
</div>

<div class="page-content">
  <div class="boards-grid" id="boards-grid"></div>
</div>

<footer class="site-footer">
  <div class="site-footer-sig">The Waanderer's Log · <a href="index.html">← Home</a></div>
</footer>

<!-- BOARD LIGHTBOX -->
<div class="lightbox" id="lightbox">
  <div class="lightbox-header">
    <div>
      <div class="lightbox-title" id="lb-title">Board Name</div>
      <div style="font-size:0.55rem;color:var(--text-dim);margin-top:0.3rem" id="lb-desc"></div>
    </div>
    <div style="display:flex;gap:0.8rem;align-items:center">
      <button class="btn btn-danger" id="lb-delete-board" style="font-size:0.5rem;">✕ Delete Board</button>
      <button class="lightbox-close" onclick="closeLightbox()">✕ Close</button>
    </div>
  </div>
  <div class="lightbox-body">
    <div class="lightbox-image-grid" id="lb-images"></div>
  </div>
</div>

<!-- NEW BOARD MODAL -->
<div class="modal-bg" id="board-modal">
  <div class="modal">
    <div class="modal-title">New Moodboard</div>
    <div class="form-row"><label>Board Title *</label><input type="text" id="b-name" placeholder="e.g. Desert Cityscapes"></div>
    <div class="form-row"><label>Description</label><textarea id="b-desc" placeholder="What's the vibe or theme?"></textarea></div>
    <div class="modal-actions">
      <button class="btn" onclick="closeModal('board-modal')">Cancel</button>
      <button class="btn btn-primary" onclick="createBoard()">Create Board</button>
    </div>
  </div>
</div>

<!-- IMAGE UPLOAD (hidden) -->
<input type="file" id="img-upload" accept="image/*" multiple style="display:none" onchange="handleImageUpload(event)">

<script>
const KEY = 'waanderer_boards';
let activeBoardIdx = -1;

function getBoards() { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
function setBoards(a) { localStorage.setItem(KEY, JSON.stringify(a)); }

function createBoard() {
  const name = document.getElementById('b-name').value.trim();
  if (!name) return alert('Please enter a board title.');
  const boards = getBoards();
  boards.push({ name, desc: document.getElementById('b-desc').value.trim(), images: [] });
  setBoards(boards);
  closeModal('board-modal');
  document.getElementById('b-name').value = '';
  document.getElementById('b-desc').value = '';
  render();
}

function deleteBoard(idx) {
  if (!confirm('Delete this entire board?')) return;
  const boards = getBoards();
  boards.splice(idx, 1);
  setBoards(boards);
  closeLightbox();
  render();
}

function openLightbox(idx) {
  activeBoardIdx = idx;
  const boards = getBoards();
  const b = boards[idx];
  document.getElementById('lb-title').textContent = b.name;
  document.getElementById('lb-desc').textContent = b.desc || '';
  document.getElementById('lb-delete-board').onclick = () => deleteBoard(idx);
  renderLightboxImages(b.images || []);
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.body.style.overflow = '';
  activeBoardIdx = -1;
}

function renderLightboxImages(images) {
  const grid = document.getElementById('lb-images');
  grid.innerHTML = images.map((src, i) => `
    <div class="lightbox-img-item">
      <img src="${src}" alt="">
      <button class="delete-img" onclick="removeImage(${i})">✕</button>
    </div>
  `).join('') + `
    <button class="lightbox-add-btn" onclick="document.getElementById('img-upload').click()">
      <span style="font-size:1.4rem;font-weight:100">+</span>
      <span>Add Images</span>
    </button>`;
}

function removeImage(imgIdx) {
  if (!confirm('Remove this image?')) return;
  const boards = getBoards();
  boards[activeBoardIdx].images.splice(imgIdx, 1);
  setBoards(boards);
  renderLightboxImages(boards[activeBoardIdx].images);
  render();
}

function handleImageUpload(e) {
  const files = Array.from(e.target.files);
  if (activeBoardIdx < 0) return;
  const boards = getBoards();
  let loaded = 0;
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = ev => {
      boards[activeBoardIdx].images.push(ev.target.result);
      loaded++;
      if (loaded === files.length) {
        setBoards(boards);
        renderLightboxImages(boards[activeBoardIdx].images);
        render();
      }
    };
    reader.readAsDataURL(file);
  });
  e.target.value = '';
}

function render() {
  const boards = getBoards();
  const grid = document.getElementById('boards-grid');

  const cards = boards.map((b, i) => {
    const imgs = (b.images || []).slice(0, 4);
    const thumbs = Array(4).fill(null).map((_, j) =>
      imgs[j]
        ? `<div class="board-img-thumb"><img src="${imgs[j]}" alt=""></div>`
        : `<div class="board-img-thumb board-empty-thumb">◈</div>`
    ).join('');

    return `
    <div class="board-card reveal" onclick="openLightbox(${i})">
      <div class="board-images">
        <div class="board-images-grid">${thumbs}</div>
        <div class="board-overlay">
          <span style="font-size:0.6rem;letter-spacing:0.3em;text-transform:uppercase;color:var(--sand-gold)">Open Board</span>
        </div>
      </div>
      <div class="board-info">
        <div class="board-name">${b.name}</div>
        ${b.desc ? `<div class="board-desc">${b.desc}</div>` : ''}
        <div class="board-count">${(b.images || []).length} image${(b.images||[]).length !== 1 ? 's' : ''}</div>
      </div>
    </div>`;
  }).join('');

  grid.innerHTML = cards + `
    <div class="add-board-btn" onclick="openModal('board-modal')">
      <span style="font-size:1.6rem;font-weight:100">+</span>
      <span>New Moodboard</span>
    </div>`;

  setTimeout(() => document.querySelectorAll('.reveal').forEach(el => el.classList.add('visible')), 50);
}

function openModal(id) {
  document.getElementById(id).classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
  document.body.style.overflow = '';
}
document.querySelectorAll('.modal-bg').forEach(bg => {
  bg.addEventListener('click', e => { if (e.target === bg) closeModal(bg.id); });
});
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-bg.open').forEach(m => closeModal(m.id));
    closeLightbox();
  }
});

render();
</script>
</body>
</html>
